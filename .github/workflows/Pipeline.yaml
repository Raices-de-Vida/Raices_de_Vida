name: Test BÃ¡sico - Primer Workflow

# Este workflow se ejecuta manualmente y con cada push
on:
  push:
    branches: [ main, develop, test-* ]
  workflow_dispatch:  # Permite ejecutarlo manualmente desde GitHub
    inputs:
      test_level:
        description: 'Nivel de prueba'
        required: true
        default: 'basic'
        type: choice
        options:
          - basic
          - backend
          - frontend
          - full

jobs:
  test-basic:
    name: Prueba BÃ¡sica
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4

    - name: ğŸ¯ Mostrar informaciÃ³n
      run: |
        echo "ğŸš€ Probando GitHub Actions!"
        echo "ğŸ“‚ Repositorio: ${{ github.repository }}"
        echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
        echo "ğŸ‘¤ Autor: ${{ github.actor }}"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        echo "ğŸ® Evento: ${{ github.event_name }}"
        echo "ğŸ“Š Nivel: ${{ inputs.test_level || 'auto' }}"

    - name: ğŸ“‹ Listar archivos del proyecto
      run: |
        echo "Estructura del proyecto:"
        ls -la
        echo ""
        echo "Carpetas principales:"
        ls -d */ 2>/dev/null || echo "No hay carpetas"

  test-backend:
    name: Test Backend RÃ¡pido
    runs-on: ubuntu-latest
    if: github.event.inputs.test_level == 'backend' || github.event.inputs.test_level == 'full' || github.event_name == 'push'
    
    defaults:
      run:
        working-directory: ./Backend

    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: ğŸ“¦ Verificar package.json
      run: |
        echo "Verificando Backend..."
        cat package.json | grep '"name"'
        cat package.json | grep '"version"'

    - name: ğŸ“š Instalar dependencias
      run: |
        echo "Instalando dependencias del backend..."
        npm ci
        echo "âœ… Dependencias instaladas"

    - name: ğŸ§ª Test simple (sin DB)
      run: |
        echo "Ejecutando test bÃ¡sico..."
        npm test -- --testPathPattern=basic || echo "âš ï¸ No hay tests bÃ¡sicos configurados aÃºn"

  test-frontend:
    name: Test Frontend RÃ¡pido
    runs-on: ubuntu-latest
    if: github.event.inputs.test_level == 'frontend' || github.event.inputs.test_level == 'full' || github.event_name == 'push'
    
    defaults:
      run:
        working-directory: ./Frontend

    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: ğŸ“¦ Verificar package.json
      run: |
        echo "Verificando Frontend..."
        cat package.json | grep '"name"'
        cat package.json | grep '"version"'

    - name: ğŸ“š Instalar dependencias
      run: |
        echo "Instalando dependencias del frontend..."
        npm install --legacy-peer-deps
        echo "âœ… Dependencias instaladas"

    - name: âœ… VerificaciÃ³n completada
      run: echo "Frontend verificado correctamente"

  summary:
    name: ğŸ“Š Resumen
    runs-on: ubuntu-latest
    needs: [test-basic, test-backend, test-frontend]
    if: always()

    steps:
    - name: ğŸ“ˆ Mostrar resultados
      run: |
        echo "===================="
        echo "ğŸ“Š RESUMEN DE PRUEBAS"
        echo "===================="
        echo "âœ… Test BÃ¡sico: ${{ needs.test-basic.result }}"
        echo "ğŸ”§ Backend: ${{ needs.test-backend.result }}"
        echo "ğŸ“± Frontend: ${{ needs.test-frontend.result }}"
        echo "===================="
        
        if [ "${{ needs.test-basic.result }}" = "success" ] && \
           [ "${{ needs.test-backend.result }}" = "success" ] && \
           [ "${{ needs.test-frontend.result }}" = "success" ]; then
          echo "ğŸ‰ Â¡TODO CORRECTO!"
          exit 0
        else
          echo "âš ï¸ Algunos tests fallaron"
          exit 0  # No fallar el workflow por ahora
        fi